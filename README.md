# bookangeles

## Installation
```
npm install -g strongloop
npm install
```

## Start application
```
slc run # or node server/server.js
npm run webpack
```

## Deploy application (could be done on locals)
```
npm start
```

## Entities

All entities have an ObjectID field which is generated by Mongo and can be converted to creation time, thus no need to store `created_at` into database.

- **user**
  - `id:number` *unique, required*
  - `displayName:string` *required*
  - `username:string` *unique, required* (just an email)
  - `password:string` *required*
  - `active:bool` *required*
  - `invites:number` *required, default=5?* (invites countdown)
  - `createdAt:timestamp` *required*

- **book**
  - `id:number` *unique, required*
  - `owner:string` *required, ref:user.username*
  - `fileName:string` *required*
  - `fileFormat:string` *required*
  - `fileUrl:string` *required*
  - `title:string` 
  - `author:string` 
  - `tags:[number]` *default=[]*
  - `coverUrl:string`
  - `smallCoverUrl:string`
  - `note:string`
  - `createdAt:timestamp` *required*

- **tag**
  - `id:number` *unique, required*
  - `owner:string` *required, ref:user.username* 
  - `caption:string` *required*
  - `books:[number]` *default=[]*
  - `createdAt:timestamp` *required*
  
- **share**
  - `id:number` *unique, required*
  - `owner:string` *required ref:user.username*
  - `recipient:string` *required, unique_max_per_owner=3, ref:user.username*
  - `type:string` *required, one_of=['all', 'tag', 'book']*
  - `value:string` *required, one_of=['all', tagname, book:id]*
  - `createdAt:timestamp` *required*

- **invite**
  - `id:number` *unique, required*
  - `owner:string` *required*
  - `recipient:string` *required*
  - `resolved:bool` *required*
  - `resolvedAt:date` *required*
  - `createdAt:timestamp` *required*

## Endpoints

### Client

**register client**

`POST /api/clients/login`

payload: `{ "displayName": "Username", "email": "mail@box.com", "password": "sesame" }`

**login client**

`POST /api/clients/login`

payload: `{ "email": "mail@box.com", "password": "sesame" }`

response:

	{
	  "id": "cE83vS1vS8mNwtHZZnnejO68AfhlDNTNpF8Cq3CL8Qaq3WteGzjDpcoTrPsaAkPV", //access_token
	  "ttl": 1209600,
	  "created": "2016-02-21T11:32:18.882Z",
	  "userId": 1
	}


### Book

**fetch books for user**

`GET /bapi/books?access_token=token[&tag=id]`

response: list of books

**add book**

`POST /bapi/books`

payload:

	{ 
	  "access_token": "token",
	  "book": file,
	  "title": "...",
	  "author": "...",
	  "note": "..."
	}

response: added book object

**update book**

`POST /bapi/books/:id`

payload:

  { 
    "title": "...",
    "author": "...",
    "note": "...",
    "tags": [ ... ]
  }

### Tag

**fetch tags for user**

`GET /bapi/tags?access_token=token[&tag=id]`

response: list of tags

**add tag**

`POST /bapi/tags`

payload:

  { 
    "access_token": "token",
    "caption": "...",
    "color": "..."
  }

response: added tag object

